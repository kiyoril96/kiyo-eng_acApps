# kiyo-eng_frictionCircle
摩擦円描画アプリ

# これは何？
こんなのです

https://github.com/kiyoril96/kiyo-eng_acApps/assets/57058532/1ee0d9e8-556c-4bf3-99a9-7537917a252b

### 摩擦円の大体の説明
* 色付きの円の大きさはタイヤの最大静止摩擦力を表します。
  * ”その瞬間タイヤが発揮できるグリップ力” です。
  * 緑色に近ければグリップしています。
  * 赤色に近ければ滑っている状態です。
  * 滑り出し直前に黄色くなります。
  * 縦方向（進行方向）と横方向で発生する摩擦力の特性が変わるため、基本的には楕円型をしています。
  * 摩擦力は垂直抗力と摩擦係数で決定するため、タイヤあたりの荷重によって大きさが変化しています。
    * ⇒円の大きさは「だいたいタイヤに掛かっている荷重」と思ってもらっても差し支えないと思います。
* 設定でONにすると白の同心円が出現します。
  * 一番内側の円は”車が静止状態の時に掛かっているはずの荷重”を半径にしています。
    * 車重÷4 です。車高などのセッティングによって必ずしも一致しません。
    * ⇒ つまりベクトルであればだいたい1Gの重力加速度に相当するはずです。
  * 外側の円は一番内側の円の×2、×3、×4の半径です。
    * ⇒ つまりベクトルであればだいたい2G、3G、4Gの重力加速度に相当するはずです。
    * 円の大きさでダウンフォースもなんとなく可視化できるかも。
    * （2Gくらいで十分だと思ってたんだけど、F1とかの3Gくらいかけてるの見たので用意してみた。さすがに十分でしょ?）
* 水色、オレンジ色の線は実際に発生している摩擦力のベクトルを表します。
  * 設定によって車の座標系を基準にするか、タイヤの座標系を基準にするか選択できます。
  * 水色の線が発生している静止摩擦力に相当します。
  * オレンジ色の線は水色の線にスリップ率を乗算したものです。
    * スリップ率が1を超える（円の半径および水色の線の大きさを超える）とタイヤは滑っている（動摩擦を発生させている）状態です。 
  * タイヤに対して横向きの力は、だいたいコーナリングフォースに該当します。
  * タイヤに対して縦向きの力は、だいたい加速力か原則力に該当します。
* オプションで青色の線を追加できます。車体に掛かる加速度に該当します。
  * 特に実装が大雑把になっています。正しいと思わない方がいい。
  * 見た感じそれっぽくはなってます。
* オプションで白色の線を追加できます。実際の摩擦力と加速度のベクトルを合算しています。
  * これは....何を意味するんでしょうかね（（
* オプションで色付きの扇型を追加できます。スリップアングルを可視化したものです。
  * タイヤが進もうとしている方向とタイヤの実際の向きの角度差を表します。
  * ”一番よくグリップするところ”が存在するみたいです。それが緑色になるようになっています。
  * 最適角度より小さい場合は黄色、最適角度より大きい場合は赤色になります。
    * よくわかんないけど全部緑にして走れば早いってわけでもないと思います。目安としてご利用ください。

# インストール

#### コンテンツマネージャを使っている場合
1. 最新のリリースのZIPファイルをダウンロードしてください。
2. コンテンツマネージャにドラッグ&ドロップします。
3. 右上三本線マークからInstallボタンを押せばOKです。

#### コンテンツマネージャを使っていない場合
※ コンテンツマネージャの利用を推奨します。
※ CSPが導入済みである必要があります。
1. 最新のリリースのZIPファイルをダウンロードしてください。
2. 「kiyo-eng_frictionCircle」のフォルダをアセットコルサのLuaAppのフォルダに抽出してください。

# 使い方
* 次にアセットコルサを起動すると緑色の円が4つ出現していると思います。
* アプリ一覧の中に下記5つのアプリが増えていると思います。
  * kiyo-eng_frictionCircle ： 設定画面です。
  * FL ： フロント左側タイヤを個別に表示します。
  * FR ： フロント右側タイヤを個別に表示します。
  * RL ： リア左側タイヤを個別に表示します。
  * RR ： リア右側タイヤを個別に表示します。

## 設定画面
* kiyo-eng_frictionCircle のウインドウで円のサイズ、位置などを調整できます。
* 設定は保存されます。再設定の必要はありません。

### 設定項目
* Active : 摩擦円の表示非表示を切り替えます。個別ウインドウおよびOBSテクスチャには影響しません。
* Guage : 白枠（ゲージ）を追加します。（なんて呼べばいいかまだ分かってない）ドロップダウンで枠の数を選択します。
* Reference Direction : 摩擦円表示の基準を設定します。 Wheelだとタイヤ（ホイール）の方向に合わせて動きます。Carだと固定表示になります。
* Width : UIの幅を調整します。V1.5までの OFFSETX、OFFSETYに該当し、プラスの値で真ん中に寄り、マイナスの値で外側に広がります。
* Offset : UIそのものを上下左右に動かします。個別ウインドウおよびOBSテクスチャには影響しません。
* Size : UIの大きさを調整します。V1.5までのSCALEに該当します。
* Thickness : 円の外周、ベクトルの線の太さを調整します。
* Optional : 摩擦円と直接は関係なさそうなオプション機能です。チェックを入れると表示されます。
  * Gforce Vector : 車体に掛かる加速度を表示します。
  * Composite : 車体加速度と実際の摩擦力のベクトルを合成したものを表示します。
  * Slip Angle : タイヤの向きと実際に進む方向の角度差を扇形で表示します。

### 個別ウインドウについて
* マウスオーバーするとウインドウが見えるようになります。
* サイズ調整、位置調整を自由に行ってください。

### OBSテクスチャについて
* OBS統合のセットアップができていれば、摩擦円単体をOBSソースとして映すことができます。
* ソースに「AssettoCorsa」を追加した後Textureから「kiyo-eng_OBSTexture: FrictionCircle(transparent)」を選んでください。
* OBSのWidth、Heightはプレイ画面に合わせるのがベストですが、異なっていても大きな問題にはならないはずです。
* ゲーム内アプリのWidth、Size、Thicknessなどがサイズの比率を考慮して適用されます。
* 色の調整が上手く行っておらず、OBSに半透明部分がうまく映りませんので、適宜「色調整」フィルタ等で見やすく加工してほしいです。

# 既知の問題
#### リプレイでは正しく動作しない
* 現状は標準機能だと摩擦円のみ（ベクトルなし）、オプション機能についても加速度表示のみが機能します。
* 摩擦円についても摩擦係数が取得できないため正しい表示になっていません。
* 正しい表示を後から見返す必要がある場合はOBSテクスチャをご利用ください。

#### 個別ウインドウが見切れる
* 都合上、見切れます。
* サイズを調整して使ってください。

#### ~~作者の英語力がない~~
* 英語が書けないので日本語ドキュメントしかありません。
* ISSUESとかプルリクとか来たら頑張って読みます。反応遅いけどゆるして。
* The author is not good at English, but will do his best to read any issues or pull requests. We apologize in advance for the time it will take.
* （精一杯のDeepL）

# 謝辞
* アプリ制作にあたり（主にXで）複数のご助力をいただいております。いつもありがとうございます！！
  * 楕円の描画関数：キノさん(@Akeyroid7)
  * 車両物理全般：もんちゃんさん(@Monchan_pien)