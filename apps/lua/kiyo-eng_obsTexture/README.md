# kiyo-eng_obsTexture
OBSIntegration用テクスチャ追加アプリ 

# これは何？
* CSP0.1.8くらいから追加されたOBS統合機能へ、追加の画面を提供するアプリです。
* ~~もともとある問題をいくつか無理やり修正しています。~~
  * 性質上、CSPのアップデートで無用の長物となる可能性があります。 ⇒ なりました。
* いろいろ試した結果、CSPのオプションで不具合を回避できることが分かったので、無理やり修正していた部分は消しました。
  * ”CSPのオプション” → 使い方に書きます。

# インストール
* 大体一緒です

#### コンテンツマネージャを使っている場合
1. 最新のリリースのZIPファイルをダウンロードしてください。
2. コンテンツマネージャにドラッグ&ドロップします。
3. 右上三本線マークからInstallボタンを押せばOKです。

#### コンテンツマネージャを使っていない場合
※ コンテンツマネージャの利用を推奨します。
※ CSPが導入済みである必要があります。
1. 最新のリリースのZIPファイルをダウンロードしてください。
2. 「kiyo-eng_obsTexture」のフォルダをアセットコルサのLuaAppのフォルダに抽出してください。

# 使い方
* OBSを導入しておいてください。
  * https://obsproject.com/ja/download
* アセットコルサのOBSプラグインを導入してください。
  * https://github.com/ac-custom-shaders-patch/acc-obs-plugin
  * CSP設定ののSMALL TWEAKS > OBS Integration > "Path texture data to OBS directly" にもチェック入れてね～。
  * "High quality render for default OBS views" はこのアプリには影響しません。(もちろん最初から入っているものには影響があります。)

## OBS側
* OBSで操作する項目を説明します。

### 基本
* OBSとアセットコルサが同時に起動している状態だとアプリが動作するはずです。
* OBSのソースの追加から"Assett Corsa" を選びます。
* Texture のドロップダウンに"kiyo-eng_OBSTexture:"がついているものがこのアプリが生成したものです。
  * もし出てきていなければアプリがエラーを起こしているか導入に失敗していると思います。
  * 不具合っぽければ教えてね。
* 設定をしてOKを押せば画面に出てくると思います。あとはOBSのマニュアル参照です。

### 詳細 
* Width Height はお好みで調整してください。
  * 解像度が低ければ処理が軽くなるはず？
  * ゲーム解像度と一致させると処理が１回で済むから軽いらしい？
* Brightness は明るさです。100%推奨。
* Skip frames はフレームを間引きする機能です。（たぶん）
  * 1フレームでもスキップすると軽くなります。おすすめ。

## アセットコルサ側
* アセットコルサで操作する項目を説明します。

### アプリ
* アプリ一覧の中に "kiyo-eng_OBSTexture_config" が増えていると思います。
  * チェイスカメラの設定をするための画面です。
* DISTANCE：車から前後方向へカメラを動かします。
* HEIGHT：垂直方向にカメラを動かします。
* PITCH：カメラの向きを上下に動かします。車のほうを向くようになっているので、単純な角度ではありません。
* FOV：画角です。カメラの位置はそのままに映る範囲を調整します。

### トラックカメラ
* トラックカメラは一旦キー操作で変更してください。（標準だとF3キー）
* 最後に表示したトラックカメラがOBSに映ります。

# このアプリの存在意義
* これがあると何がうれしいのか

#### 煙が出る
* 標準のままだと、プレイ中に高品質レンダリングをしても煙が出ません。ドリフトの迫力がない…
* かといって高品質レンダリングをしていないと
  * 影が映らない
  * 表示されないオブジェクトがある
* などの問題があります。これを（無理やり）解決します。
  * 無理やり？
    * 高品質でレンダリングしたもの（煙が出ない）と通常のもの（影が出ない）を重ねて描画しました。
    * お察しの通りPCへの負荷が高いです。
* 実はリプレイを録画する目的だと煙は出るので標準のものを使っても特に問題ないです。

#### 一人称視点でのプレイ時に頭が表示される
* 標準だと表示されず、首なしドライバーになってしまいます。ホラー。
* まあこれは1個フラグを操作するだけで済みます。

#### チェイスカメラの改善
* 標準のチェイスカメラだとなんか物足りないですよね？（圧
* チェイスカメラスクリプトのBaseに近い挙動になるようにしました。
* これもちゃんと（？）煙が出ます。

## これだけです
* ほんとにこれだけです。
* なのでCSPのアップデートで無用になる可能性が高いです。その時は標準を使うといいと思う。

# 既知の問題
### 煙薄くない？
* ~~バレたか~~
* 煙が出ている画面を30%、影が正しくついている画面を70%の濃度でブレンドしています。
* ちょっとしょうがないですが、出ないよりはマシってことで…

### FPSの低下
* GPUにレンダリングされたテクスチャをほかのアプリケーションへ共有するという機能を使っているようです。
* このためGPUのパワーを結構使います。これはちょっとどうしようもない。
* ~~レンダリングさえしなければ負荷はないので、OBSを閉じると良いです。~~
* OBS側のフレームスキップを活用してください。

### アプリからトラックカメラ選べないの？
* 選べるようにしたらゲーム自体が落ちたんだよね…
* できるようになりそうだったら追加します。